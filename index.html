<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>数独直观解题器</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: "Microsoft YaHei", sans-serif;
            touch-action: manipulation;
        }

        body {
            background-color: #f5f5f5;
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 15px;
            min-height: 100vh;
            width: 100%;
            overflow-x: hidden; /* 禁止横向滚动 */
        }

        h1 {
            color: #333;
            font-size: 24px;
            margin-bottom: 15px;
            text-align: center;
        }

        /* 数独容器 - 适配手机，消除滚动 */
        .sudoku-container {
            display: grid;
            grid-template-columns: repeat(9, 45px);
            grid-template-rows: repeat(9, 45px);
            background-color: #000;
            border: 2px solid #000;
            margin: 0 auto 10px;
            max-width: 100%; /* 适配手机宽度 */
            width: fit-content; /* 自适应内容宽度 */
        }

        /* 单元格基础样式 - 禁用输入法唤起 */
        .sudoku-container input {
            width: 45px;
            height: 45px;
            text-align: center;
            font-size: 20px;
            border: none;
            outline: none;
            -webkit-user-select: none; /* 禁止选中文字 */
            user-select: none;
            transition: background-color 0.2s ease; /* 过渡效果，更顺滑 */
        }

        /* 9个宫格的基础颜色 */
        .sudoku-container input[data-row="0"][data-col="0"],
        .sudoku-container input[data-row="0"][data-col="1"],
        .sudoku-container input[data-row="0"][data-col="2"],
        .sudoku-container input[data-row="1"][data-col="0"],
        .sudoku-container input[data-row="1"][data-col="1"],
        .sudoku-container input[data-row="1"][data-col="2"],
        .sudoku-container input[data-row="2"][data-col="0"],
        .sudoku-container input[data-row="2"][data-col="1"],
        .sudoku-container input[data-row="2"][data-col="2"] {
            background-color: #e8e8e8;
        }
        .sudoku-container input[data-row="0"][data-col="3"],
        .sudoku-container input[data-row="0"][data-col="4"],
        .sudoku-container input[data-row="0"][data-col="5"],
        .sudoku-container input[data-row="1"][data-col="3"],
        .sudoku-container input[data-row="1"][data-col="4"],
        .sudoku-container input[data-row="1"][data-col="5"],
        .sudoku-container input[data-row="2"][data-col="3"],
        .sudoku-container input[data-row="2"][data-col="4"],
        .sudoku-container input[data-row="2"][data-col="5"] {
            background-color: #ffffff;
        }
        .sudoku-container input[data-row="0"][data-col="6"],
        .sudoku-container input[data-row="0"][data-col="7"],
        .sudoku-container input[data-row="0"][data-col="8"],
        .sudoku-container input[data-row="1"][data-col="6"],
        .sudoku-container input[data-row="1"][data-col="7"],
        .sudoku-container input[data-row="1"][data-col="8"],
        .sudoku-container input[data-row="2"][data-col="6"],
        .sudoku-container input[data-row="2"][data-col="7"],
        .sudoku-container input[data-row="2"][data-col="8"] {
            background-color: #e8e8e8;
        }
        .sudoku-container input[data-row="3"][data-col="0"],
        .sudoku-container input[data-row="3"][data-col="1"],
        .sudoku-container input[data-row="3"][data-col="2"],
        .sudoku-container input[data-row="4"][data-col="0"],
        .sudoku-container input[data-row="4"][data-col="1"],
        .sudoku-container input[data-row="4"][data-col="2"],
        .sudoku-container input[data-row="5"][data-col="0"],
        .sudoku-container input[data-row="5"][data-col="1"],
        .sudoku-container input[data-row="5"][data-col="2"] {
            background-color: #ffffff;
        }
        .sudoku-container input[data-row="3"][data-col="3"],
        .sudoku-container input[data-row="3"][data-col="4"],
        .sudoku-container input[data-row="3"][data-col="5"],
        .sudoku-container input[data-row="4"][data-col="3"],
        .sudoku-container input[data-row="4"][data-col="4"],
        .sudoku-container input[data-row="4"][data-col="5"],
        .sudoku-container input[data-row="5"][data-col="3"],
        .sudoku-container input[data-row="5"][data-col="4"],
        .sudoku-container input[data-row="5"][data-col="5"] {
            background-color: #e8e8e8;
        }
        .sudoku-container input[data-row="3"][data-col="6"],
        .sudoku-container input[data-row="3"][data-col="7"],
        .sudoku-container input[data-row="3"][data-col="8"],
        .sudoku-container input[data-row="4"][data-col="6"],
        .sudoku-container input[data-row="4"][data-col="7"],
        .sudoku-container input[data-row="4"][data-col="8"],
        .sudoku-container input[data-row="5"][data-col="6"],
        .sudoku-container input[data-row="5"][data-col="7"],
        .sudoku-container input[data-row="5"][data-col="8"] {
            background-color: #ffffff;
        }
        .sudoku-container input[data-row="6"][data-col="0"],
        .sudoku-container input[data-row="6"][data-col="1"],
        .sudoku-container input[data-row="6"][data-col="2"],
        .sudoku-container input[data-row="7"][data-col="0"],
        .sudoku-container input[data-row="7"][data-col="1"],
        .sudoku-container input[data-row="7"][data-col="2"],
        .sudoku-container input[data-row="8"][data-col="0"],
        .sudoku-container input[data-row="8"][data-col="1"],
        .sudoku-container input[data-row="8"][data-col="2"] {
            background-color: #e8e8e8;
        }
        .sudoku-container input[data-row="6"][data-col="3"],
        .sudoku-container input[data-row="6"][data-col="4"],
        .sudoku-container input[data-row="6"][data-col="5"],
        .sudoku-container input[data-row="7"][data-col="3"],
        .sudoku-container input[data-row="7"][data-col="4"],
        .sudoku-container input[data-row="7"][data-col="5"],
        .sudoku-container input[data-row="8"][data-col="3"],
        .sudoku-container input[data-row="8"][data-col="4"],
        .sudoku-container input[data-row="8"][data-col="5"] {
            background-color: #ffffff;
        }
        .sudoku-container input[data-row="6"][data-col="6"],
        .sudoku-container input[data-row="6"][data-col="7"],
        .sudoku-container input[data-row="6"][data-col="8"],
        .sudoku-container input[data-row="7"][data-col="6"],
        .sudoku-container input[data-row="7"][data-col="7"],
        .sudoku-container input[data-row="7"][data-col="8"],
        .sudoku-container input[data-row="8"][data-col="6"],
        .sudoku-container input[data-row="8"][data-col="7"],
        .sudoku-container input[data-row="8"][data-col="8"] {
            background-color: #e8e8e8;
        }

        /* 宫间粗线条分隔 */
        .sudoku-container input:nth-child(3n) {
            border-right: 2px solid #000 !important;
        }
        .sudoku-container input:nth-child(n+19):nth-child(-n+27),
        .sudoku-container input:nth-child(n+46):nth-child(-n+54) {
            border-bottom: 2px solid #000 !important;
        }

        /* 宫内细线条分隔 */
        .sudoku-container input:not(:nth-child(3n)) {
            border-right: 1px solid #ccc;
        }
        .sudoku-container input:not(:nth-child(n+19):nth-child(-n+27)):not(:nth-child(n+46):nth-child(-n+54)) {
            border-bottom: 1px solid #ccc;
        }

        /* 输入样式区分 */
        .sudoku-container input.player-input {
            font-weight: bold;
            color: #0066cc;
        }
        .sudoku-container input.system-input {
            color: #cc3300;
            font-weight: bold;
        }

        /* 新增：选中单元格高亮（淡绿色） */
        .sudoku-container input.active-cell {
            background-color: #b7f0b7 !important; /* 淡绿色，!important覆盖宫格基础颜色 */
            border: 2px solid #66cc66 !important; /* 增加边框，更醒目 */
        }

        /* 新增：选中单元格的同行同列（深灰色） */
        .sudoku-container input.same-row-col {
            background-color: #d0d0d0 !important; /* 深灰色，!important覆盖宫格基础颜色 */
            opacity: 0.8; /* 稍微透明，避免遮挡宫格区分 */
        }

        /* 数字输入区 */
        .number-selector {
            display: flex;
            gap: 8px;
            justify-content: center;
            margin-bottom: 15px;
            width: 100%;
            max-width: calc(45px * 9 + 4px);
        }
        .number-btn {
            width: 40px;
            height: 40px;
            font-size: 18px;
            font-weight: bold;
            border: none;
            border-radius: 0;
            background-color: #fff;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: background-color 0.2s;
            box-shadow: 0 1px 2px rgba(0,0,0,0.1);
            flex-shrink: 0; /* 防止按钮被压缩 */
        }
        .number-btn:hover, .number-btn.active {
            background-color: #e0e0e0;
        }

        /* 交互按钮组 - 修改为纵向排列（同一列），文字两字一行 */
        .btn-group {
            display: flex;
            flex-direction: column; /* 纵向排列，同一列 */
            gap: 8px; /* 缩小按钮间距 */
            margin-bottom: 15px;
            justify-content: center;
            align-items: center; /* 按钮居中 */
            width: 100%;
            max-width: 60px; /* 缩小容器宽度，适配按钮 */
        }
        .btn-group button {
            width: 50px; /* 缩小按钮宽度 */
            height: 50px; /* 缩小按钮高度 */
            font-size: 12px; /* 缩小字体 */
            font-weight: bold;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            transition: background-color 0.3s;
            display: flex;
            align-items: center;
            justify-content: center;
            flex-shrink: 0;
            word-break: break-all; /* 强制文字换行，实现两字一行 */
            line-height: 1.2; /* 调整行高，让两行文字更美观 */
            padding: 2px;
        }
        #backspace {
            background-color: #dc3545;
            color: #fff;
        }
        #backspace:hover {
            background-color: #c82333;
        }
        #backspace:disabled {
            background-color: #dc888f;
            cursor: not-allowed;
        }
        #prevStep {
            background-color: #6c757d;
            color: #fff;
        }
        #prevStep:hover {
            background-color: #5a6268;
        }
        #prevStep:disabled {
            background-color: #adb5bd;
            cursor: not-allowed;
        }
        #nextStep {
            background-color: #0066cc;
            color: #fff;
        }
        #nextStep:hover {
            background-color: #0052aa;
        }
        #nextStep:disabled {
            background-color: #6699cc;
            cursor: not-allowed;
        }
        #clearAll {
            background-color: #ff9900;
            color: #fff;
        }
        #clearAll:hover {
            background-color: #e68a00;
        }
        #solveAll {
            background-color: #00cc66;
            color: #fff;
        }
        #solveAll:hover {
            background-color: #00b359;
        }

        /* 状态信息 - 适配手机 */
        .status-area {
            width: 100%;
            max-width: calc(45px * 9 + 4px);
            padding: 12px;
            background-color: #fff;
            border-radius: 5px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
            min-height: 45px;
            color: #333;
            font-size: 14px;
            text-align: center;
        }

        /* 响应式适配 - 优化手机显示 */
        @media (max-width: 500px) {
            .sudoku-container {
                grid-template-columns: repeat(9, calc((100vw - 30px) / 9)); /* 适配手机宽度 */
                grid-template-rows: repeat(9, calc((100vw - 30px) / 9));
            }
            .sudoku-container input {
                width: 100%;
                height: 100%;
                font-size: 18px;
            }
            .number-btn {
                width: calc((100vw - 72px) / 9);
                height: calc((100vw - 72px) / 9);
                font-size: 16px;
            }
            .btn-group {
                max-width: 50px; /* 手机端进一步缩小按钮容器 */
            }
            .btn-group button {
                width: 45px; /* 手机端缩小按钮 */
                height: 45px;
                font-size: 11px;
            }
            .status-area {
                font-size: 13px;
                padding: 10px;
            }
            h1 {
                font-size: 20px;
            }
        }
    </style>
</head>
<body>
    <h1>数独直观解题器</h1>
    <!-- 数独网格 -->
    <div class="sudoku-container" id="sudokuGrid"></div>
    <!-- 数字输入区 -->
    <div class="number-selector">
        <button class="number-btn" data-num="1">1</button>
        <button class="number-btn" data-num="2">2</button>
        <button class="number-btn" data-num="3">3</button>
        <button class="number-btn" data-num="4">4</button>
        <button class="number-btn" data-num="5">5</button>
        <button class="number-btn" data-num="6">6</button>
        <button class="number-btn" data-num="7">7</button>
        <button class="number-btn" data-num="8">8</button>
        <button class="number-btn" data-num="9">9</button>
    </div>
    <!-- 功能按钮组 - 纵向排列 -->
    <div class="btn-group">
        <button id="backspace">退格</button> <!-- 简化文字，更易换行美观 -->
        <button id="prevStep" disabled>上一</button>
        <button id="nextStep">下一</button>
        <button id="clearAll">清空</button>
        <button id="solveAll">全解</button>
    </div>
    <!-- 状态信息 -->
    <div class="status-area" id="statusArea">请输入数独初始数字，点击「下一步」开始解题</div>

    <script>
        // 全局变量
        let sudokuGrid;
        let sudokuData = Array(9).fill().map(() => Array(9).fill(''));
        let history = [];
        let currentStep = -1;
        let activeCell = null;
        let correctSolution = null;
        let inputHistory = []; // 记录输入历史，用于退格

        // 页面加载完成后初始化
        window.onload = function() {
            initSudokuGrid();
            bindButtonEvents();
            bindNumberSelector();
            updateButtonStates(); // 初始化按钮状态
        };

        /**
         * 初始化数独网格 - 禁用输入法唤起
         */
        function initSudokuGrid() {
            sudokuGrid = document.getElementById('sudokuGrid');
            for (let row = 0; row < 9; row++) {
                for (let col = 0; col < 9; col++) {
                    const input = document.createElement('input');
                    input.type = 'text';
                    input.maxLength = 1;
                    input.dataset.row = row;
                    input.dataset.col = col;
                    input.readOnly = true; // 禁用输入法唤起
                    input.tabIndex = -1; // 移除焦点唤起键盘

                    // 激活单元格，添加高亮和同行同列样式
                    input.onclick = function() {
                        // 移除之前所有的高亮和同行同列样式
                        clearCellHighlight();
                        
                        // 记录当前激活单元格
                        activeCell = this;
                        const currentRow = parseInt(this.dataset.row);
                        const currentCol = parseInt(this.dataset.col);
                        
                        // 给当前单元格添加高亮样式
                        this.classList.add('active-cell');
                        
                        // 给同行同列单元格添加深灰色样式
                        highlightRowCol(currentRow, currentCol);
                        
                        // 移除数字按钮的激活状态
                        document.querySelectorAll('.number-btn').forEach(btn => btn.classList.remove('active'));
                    };

                    sudokuGrid.appendChild(input);
                }
            }
        }

        /**
         * 清除所有单元格的高亮和同行同列样式
         */
        function clearCellHighlight() {
            const allInputs = sudokuGrid.querySelectorAll('input');
            allInputs.forEach(input => {
                input.classList.remove('active-cell');
                input.classList.remove('same-row-col');
            });
        }

        /**
         * 高亮指定行和列的单元格
         * @param {number} row - 目标行
         * @param {number} col - 目标列
         */
        function highlightRowCol(row, col) {
            const allInputs = sudokuGrid.querySelectorAll('input');
            allInputs.forEach(input => {
                const inputRow = parseInt(input.dataset.row);
                const inputCol = parseInt(input.dataset.col);
                
                // 同行或同列，且不是当前激活单元格
                if ((inputRow === row || inputCol === col) && !(inputRow === row && inputCol === col)) {
                    input.classList.add('same-row-col');
                }
            });
        }

        /**
         * 绑定数字选择按钮事件
         */
        function bindNumberSelector() {
            document.querySelectorAll('.number-btn').forEach(btn => {
                btn.onclick = function() {
                    if (!activeCell) return;
                    
                    const num = this.dataset.num;
                    const row = parseInt(activeCell.dataset.row);
                    const col = parseInt(activeCell.dataset.col);
                    const oldValue = sudokuData[row][col];

                    // 记录输入历史（仅当值变化时）
                    if (oldValue !== num) {
                        inputHistory.push({
                            row: row,
                            col: col,
                            oldValue: oldValue
                        });
                    }
                    
                    // 更新数据和DOM
                    activeCell.value = num;
                    sudokuData[row][col] = num;
                    activeCell.classList.add('player-input');
                    activeCell.classList.remove('system-input');
                    
                    resetHistory(); // 输入新数字重置解题历史
                    
                    document.querySelectorAll('.number-btn').forEach(b => b.classList.remove('active'));
                    this.classList.add('active');
                    updateButtonStates(); // 更新退格键状态
                };
            });
        }

        /**
         * 绑定功能按钮事件 - 新增退格键绑定
         */
        function bindButtonEvents() {
            document.getElementById('backspace').onclick = backspaceLastInput;
            document.getElementById('prevStep').onclick = prevStep;
            document.getElementById('nextStep').onclick = nextStep;
            document.getElementById('clearAll').onclick = clearAllSudoku;
            document.getElementById('solveAll').onclick = solveAllSudoku;
        }

        /**
         * 退格键功能 - 删除最近一次输入
         */
        function backspaceLastInput() {
            if (inputHistory.length === 0) {
                document.getElementById('statusArea').textContent = '暂无可删除的输入记录';
                return;
            }

            // 取出最后一次输入记录
            const lastInput = inputHistory.pop();
            const { row, col, oldValue } = lastInput;

            // 恢复数据
            sudokuData[row][col] = oldValue;
            const input = document.querySelector(`input[data-row="${row}"][data-col="${col}"]`);
            input.value = oldValue || '';
            
            // 恢复样式
            if (oldValue) {
                input.classList.add('player-input');
            } else {
                input.classList.remove('player-input');
                input.classList.remove('system-input');
            }

            // 重置解题历史
            resetHistory();
            document.getElementById('statusArea').textContent = `已删除最近一次输入（行${row+1}列${col+1}）`;
            updateButtonStates();
        }

        /**
         * 重置历史记录
         */
        function resetHistory() {
            history = [];
            currentStep = -1;
            correctSolution = null;
            updateButtonStates();
        }

        /**
         * 更新按钮状态 - 包含退格键
         */
        function updateButtonStates() {
            const backspaceBtn = document.getElementById('backspace');
            const prevBtn = document.getElementById('prevStep');
            const nextBtn = document.getElementById('nextStep');
            
            backspaceBtn.disabled = inputHistory.length === 0;
            prevBtn.disabled = currentStep <= 0;
            nextBtn.disabled = isSudokuComplete() && currentStep === history.length - 1;
        }

        /**
         * 上一步
         */
        function prevStep() {
            if (currentStep <= 0) return;
            
            currentStep--;
            const stepData = history[currentStep];
            sudokuData = JSON.parse(JSON.stringify(stepData.grid));
            updateSudokuDOM();
            
            document.getElementById('statusArea').textContent = `已回到第 ${currentStep + 1} 步`;
            updateButtonStates();
        }

        /**
         * 下一步（核心逻辑）
         */
        function nextStep() {
            const statusArea = document.getElementById('statusArea');
            
            // 首次点击下一步时，先生成正确的完整解
            if (!correctSolution) {
                const sudokuCopy = JSON.parse(JSON.stringify(sudokuData));
                if (!backtrackSolve(sudokuCopy)) {
                    statusArea.textContent = '当前数独无解（可能输入的数字存在冲突）';
                    return;
                }
                correctSolution = sudokuCopy;
            }

            // 保存当前状态到历史
            if (currentStep === history.length - 1) {
                history.push({
                    grid: JSON.parse(JSON.stringify(sudokuData))
                });
            }
            currentStep++;

            // 找到第一个空缺位置，填入正确解的数字
            let filled = false;
            let fillRow = -1, fillCol = -1;
            for (let row = 0; row < 9 && !filled; row++) {
                for (let col = 0; col < 9 && !filled; col++) {
                    if (sudokuData[row][col] === '') {
                        // 记录系统输入的历史
                        inputHistory.push({
                            row: row,
                            col: col,
                            oldValue: ''
                        });
                        sudokuData[row][col] = correctSolution[row][col];
                        filled = true;
                        fillRow = row;
                        fillCol = col;
                    }
                }
            }

            // 更新DOM和状态
            updateSudokuDOM();
            if (filled) {
                statusArea.textContent = `第 ${currentStep + 1} 步：在行${fillRow+1}列${fillCol+1}填入数字${correctSolution[fillRow][fillCol]}`;
            } else {
                statusArea.textContent = '恭喜！数独已经全部解答完成！';
            }
            updateButtonStates();
        }

        /**
         * 更新数独DOM
         */
        function updateSudokuDOM() {
            for (let row = 0; row < 9; row++) {
                for (let col = 0; col < 9; col++) {
                    const input = document.querySelector(`input[data-row="${row}"][data-col="${col}"]`);
                    const value = sudokuData[row][col];
                    
                    input.value = value || '';
                    
                    if (input.classList.contains('player-input') && value) {
                        continue;
                    }
                    
                    if (value && !input.classList.contains('player-input')) {
                        input.classList.add('system-input');
                    } else {
                        input.classList.remove('system-input');
                    }
                }
            }
        }

        /**
         * 一键清空
         */
        function clearAllSudoku() {
            sudokuData = Array(9).fill().map(() => Array(9).fill(''));
            inputHistory = []; // 清空输入历史
            resetHistory();
            
            const allInputs = sudokuGrid.querySelectorAll('input');
            allInputs.forEach(input => {
                input.value = '';
                input.classList.remove('player-input');
                input.classList.remove('system-input');
                input.classList.remove('active-cell'); // 清空时移除高亮样式
                input.classList.remove('same-row-col'); // 清空时移除同行同列样式
            });
            
            document.getElementById('statusArea').textContent = '已清空所有数字，请重新输入';
            activeCell = null;
            document.querySelectorAll('.number-btn').forEach(btn => btn.classList.remove('active'));
            updateButtonStates();
        }

        /**
         * 一键全解
         */
        function solveAllSudoku() {
            const statusArea = document.getElementById('statusArea');
            const sudokuCopy = JSON.parse(JSON.stringify(sudokuData));
            
            if (backtrackSolve(sudokuCopy)) {
                // 记录所有系统输入的历史
                for (let row = 0; row < 9; row++) {
                    for (let col = 0; col < 9; col++) {
                        if (sudokuData[row][col] === '' && sudokuCopy[row][col] !== '') {
                            inputHistory.push({
                                row: row,
                                col: col,
                                oldValue: ''
                            });
                        }
                    }
                }
                
                sudokuData = sudokuCopy;
                correctSolution = sudokuCopy;
                updateSudokuDOM();
                resetHistory();
                statusArea.textContent = '数独已一键解答完成！';
            } else {
                statusArea.textContent = '当前数独无解（可能输入的数字存在冲突）';
            }
            
            updateButtonStates();
        }

        /**
         * 回溯算法（解数独）
         */
        function backtrackSolve(board) {
            let emptyCell = null;
            for (let row = 0; row < 9; row++) {
                for (let col = 0; col < 9; col++) {
                    if (board[row][col] === '') {
                        emptyCell = [row, col];
                        break;
                    }
                }
                if (emptyCell) break;
            }
            
            if (!emptyCell) return true;
            
            const [row, col] = emptyCell;
            const candidates = getCandidatesForBoard(board, row, col);
            
            for (let num of candidates) {
                board[row][col] = num;
                
                if (backtrackSolve(board)) return true;
                
                board[row][col] = '';
            }
            
            return false;
        }

        /**
         * 获取棋盘的候选数
         */
        function getCandidatesForBoard(board, row, col) {
            const candidates = [];
            for (let num = 1; num <= 9; num++) {
                const numStr = num.toString();
                if (!isInRowForBoard(board, row, numStr) && 
                    !isInColForBoard(board, col, numStr) && 
                    !isInBoxForBoard(board, row, col, numStr)) {
                    candidates.push(numStr);
                }
            }
            return candidates;
        }

        /**
         * 棋盘版行检查
         */
        function isInRowForBoard(board, row, num) {
            return board[row].includes(num);
        }

        /**
         * 棋盘版列检查
         */
        function isInColForBoard(board, col, num) {
            for (let row = 0; row < 9; row++) {
                if (board[row][col] === num) return true;
            }
            return false;
        }

        /**
         * 棋盘版宫检查
         */
        function isInBoxForBoard(board, row, col, num) {
            const boxStartRow = Math.floor(row / 3) * 3;
            const boxStartCol = Math.floor(col / 3) * 3;
            
            for (let r = boxStartRow; r < boxStartRow + 3; r++) {
                for (let c = boxStartCol; c < boxStartCol + 3; c++) {
                    if (board[r][c] === num) return true;
                }
            }
            return false;
        }

        /**
         * 检查数独是否完成
         */
        function isSudokuComplete() {
            for (let row = 0; row < 9; row++) {
                for (let col = 0; col < 9; col++) {
                    if (sudokuData[row][col] === '') return false;
                }
            }
            return true;
        }
    </script>
</body>
</html>